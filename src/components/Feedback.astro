---
import { getLangFromUrl, useTranslations } from '../i18n/utils.js';
import Star from './icons/Star.astro';
import Facebook from './icons/Facebook.astro'
import Instagram from './icons/Instagram.astro'
import Whatsapp from './icons/Whatsapp.astro'

const testimonials = [
    {
        name: {
            en: 'John D.',
            es: 'Carlos M.',
            ru: 'Иван П.'
        },
        text: {
            en: 'Absolutely fantastic tour! The attention to detail was remarkable.',
            es: '¡Tour fantástico! La atención al detalle fue extraordinaria.',
            ru: 'Потрясающий тур! Внимание к деталям было на высшем уровне.'
        },
        star: 5
    },
    {
        name: {
            en: 'Sarah K.',
            es: 'María G.',
            ru: 'Анна С.'
        },
        text: {
            en: 'Great service and comfortable transportation. Highly recommended!',
            es: 'Excelente servicio y transporte cómodo. ¡Altamente recomendado!',
            ru: 'Отличный сервис и комфортабельный транспорт. Очень рекомендую!'
        },
        star: 4.5
    },
    {
        name: {
            en: 'Michael B.',
            es: 'Luis R.',
            ru: 'Дмитрий К.'
        },
        text: {
            en: 'Professional guides and unforgettable experiences.',
            es: 'Guías profesionales y experiencias inolvidables.',
            ru: 'Профессиональные гиды и незабываемые впечатления.'
        },
        star: 5
    },
    {
        name: {
            en: 'Emily W.',
            es: 'Ana L.',
            ru: 'Елена М.'
        },
        text: {
            en: 'The best travel agency I have ever worked with.',
            es: 'La mejor agencia de viajes con la que he trabajado.',
            ru: 'Лучшее турагентство, с которым я когда-либо работала.'
        },
        star: 4
    },
    {
        name: {
            en: 'David P.',
            es: 'Jorge S.',
            ru: 'Сергей В.'
        },
        text: {
            en: 'Everything was perfectly organized from start to finish.',
            es: 'Todo estuvo perfectamente organizado de principio a fin.',
            ru: 'Всё было идеально организовано от начала до конца.'
        },
        star: 5
    },
    {
        name: {
            en: 'Olivia T.',
            es: 'Sofía N.',
            ru: 'Ольга Ж.'
        },
        text: {
            en: 'Exceptional customer service and attention to detail.',
            es: 'Servicio al cliente excepcional y atención a los detalles.',
            ru: 'Исключительное обслуживание клиентов и внимание к деталям.'
        },
        star: 4.5
    }
]

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const sectionContent = t('feedback');

---

<section class="max-w-7xl mx-auto px-6 py-24" id="feedback">
  <div class="text-center mb-16">
    <h2 class="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-500 to-teal-600 mb-6
      leading-relaxed tracking-tightest font-kerning-auto letter-spacing-wide pb-1">
      {sectionContent.h2}
    </h2>
    <div class="w-24 h-1.5 mx-auto bg-gradient-to-r from-emerald-400 to-teal-500 rounded-full mb-6"></div>
    <p class="mt-4 sm:mt-7 text-gray-700 max-w-2xl mx-auto text-base sm:text-lg px-3 sm:px-0 font-semibold">
      {sectionContent.p}
    </p>
  </div>  

  <div class="swiper h-[320px] px-2" id="feedback-slider">
    <div class="swiper-wrapper flex items-center">
      {testimonials.map((review, index) => (
        <div class={`swiper-slide h-64 flex flex-col justify-between bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/50 dark:border-gray-700/50 transition-all duration-300 hover:shadow-md ${index === 0 ? 'ml-0' : ''}`}>
          <div>
            <h4 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
              {review.name[lang] || review.name.en}
            </h4>
            <p class="text-gray-600 dark:text-gray-300 leading-relaxed italic">
              "{review.text[lang] || review.text.en}"
            </p>
          </div>
          <div class="flex items-center gap-x-2 mt-4">
            <div class="flex">
              {[...Array(5)].map((_, i) => (
                <Star class={`w-5 stroke-emerald-800 dark:stroke-emerald-900 ${
                  i < Math.floor(review.star) ? 'fill-emerald-500' : 'fill-none'
                } ${
                  review.star % 1 !== 0 && i === Math.floor(review.star) ? 'fill-emerald-500/50' : ''
                }`}/>
              ))}
            </div>
            <strong class="text-emerald-600 dark:text-emerald-400">{review.star.toFixed(1)}</strong>
          </div>
        </div>
      ))}
    </div>

    <div class="swiper-button-prev text-emerald-500 hover:text-emerald-600 dark:hover:text-emerald-400"></div>
    <div class="swiper-button-next text-emerald-500 hover:text-emerald-600 dark:hover:text-emerald-400"></div>
  </div>

<div class="max-w-7xl mx-auto px-6 pt-8 pb-16 flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-6">
  <div class="flex items-center gap-3">
    <span class="text-lg font-medium text-gray-700">
      {sectionContent.coment}
    </span>
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-500 dark:text-emerald-400" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
    </svg>
  </div>

  <div class="flex items-center gap-4  text-emerald-500">
    <Whatsapp class="w-10 h-10 hover:scale-110 transition-all"/>
    <Facebook class="w-10 h-10 hover:scale-110 transition-all"/>
    <Instagram class="w-10 h-10 hover:scale-110 transition-all"/>
  </div>
</div>
</section>

<script>
// @ts-ignore
import Swiper from 'https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.mjs'

function initTestimonialSlider() {
  new Swiper('#feedback-slider', {
    slidesPerView: 1,
    spaceBetween: 20,
    centeredSlides: false, 
    initialSlide: 0, 
    grabCursor: true,
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    breakpoints: {
      640: {
        slidesPerView: 2,
        spaceBetween: 25,
        centeredSlides: false
      },
      1024: {
        slidesPerView: 3,
        spaceBetween: 30,
        centeredSlides: false
      }
    }
  });
}

document.addEventListener("astro:page-load", initTestimonialSlider);
</script>